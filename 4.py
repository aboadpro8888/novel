import requests
from bs4 import BeautifulSoup
import time
import urllib.parse
import random
import os
import re

# --- الإعدادات ---
BASE_URL = "https://ar-no.com/novel/%d8%ac%d9%8a%d9%86%d8%a7%d8%aa-%d8%a7%d9%84%d8%a5%d9%84%d9%87-%d8%a7%d9%84%d8%ae%d8%a7%d8%b1%d9%82%d8%a9/01-1-1000/"
HEADERS = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"}
TXT_OUTPUT = "Super_Gene_641_1000.txt"
HTML_OUTPUT = "Super_Gene_641_1000.html"

# القائمة المدمجة بالكامل (من 641 إلى 1000)
raw_chapters_text = """
1000 - قتال ملك القردة
999 - القرد ألازرق
998 - بريد الرجل الاعمي
997 - سوترا السماء المزيفة؟
996 - نص الشورى القديم
995 - غير مرئي مقابل متساوٍ
994 - شجرة إمبراطور شيطان قديمة
993 - سرقة المصدر
992 - مقياس التنين المعكوس
991 - خاتم دم التنين
990 - الحصول على جرم التنين
989 - الجرم السماوي للإمبراطور
988 - مكان الذبيحة
987 - جثث الملاك الجافة
986 - الطبقة الثالثة من سوترا دونغ شوان
985 - سر عائلة تشين
984 - الخائن نانغونغ هان
983 - الهجوم والدفاع
982 - المعلم هان على خشبة المسرح
981 - المعلم
980 - مهارة فستان الزفاف
979 - حتى سمكة القرش لم يتركها
978 - تنين أكوا الأبيض يتحرر
977 - التنين الأبيض
976 - معركة على النهر
975 - الرجل في المرجل البرونزي
974 - غرفة غامضة
973 - حفرة الأرنب
972 - ملك الأرانب غير المعقول
971 - نحلة ناب الصابر
970 - أرنب العين الحمراء
969 - فرصة واحد من كل عشرة ملايين
968 - قوة القرع
967 - دب صغير مغرور
966 - القدرة على التحكم في الحشرات
965 - الدب الأبيض المصاب
964 - القاعة القديمة
963 - متعلقات
962 - مداهمة الحديقة
961 - حديقة النباتات
960 - بابا، لا تبكي
959 - تاريخ ثورن
958 - جريمة سرقة مثالية
957 - الزجاجة المقدسة
956 - رسالة بدون كلمات
955 - أقوى المهارات
954 - غرين
953 - عين اودين
952 - الرهان
951 - ابن الآلهة
950 - المرة الاول يجب ان تكون مميزة
949 - مجموعة خاصة
948 - تجارة عادلة
947 - سهم الرجل الميت
946 - مهاجمة المأوي
945 - اغتيال
944 - بدأ الصيد
943 - الدفاع عن المأوى
942 - التخلي عن المأوي؟
941 - روح الوحش الفارس الخائن
940 - هجوم مخيف
939 - فارس فريد من نوعه
938 - الفارس يفتح عينيه
937 - فارس خائن
936 - شجرة الفارس
935 - زيرو ، ألهة الحظ
934 - جين مومنت
933 - أريد جيناتك
932 - عندما نلتقي ثانيتاً ، سأشتري لك مشروب
931 - قتل الملك فينيكس
930 - جسد العنقاء
929 - القتال علي الجينات الذاتية
928 - لست في مزاج جيد اليوم
927 - الوصول إلى قاعدة الروح الثانية
926 - الديناصور الغبي
925 - العظم
924 - مخلوق فائق؟؟
923 - انتشار اسمه
922 - خطف الطعام من فم التنين
921 - موهبة مخيفة
920 - تدينين لي بتسعة وتسعين قبلة
919 - تعالي إلي
918 - لكمة واحدة , قبلة واحدة
917 - مهارة سلبية
916 - المأوى المتحرك
915 - يوجد العديد من الملوك ، وفقط حاكم واحد
914 - لكمة واحدة
913 - ارواح غبية
912 - الملك
911 - المأوى تحت الأرض
910 - باب الشجرة
909 - شجرة ضخمة في الغابة
908 - المطالبة بتشينغ مينغ
907 - محو
906 - اختراق المأوى
905 - قتل ملك الحشرات الحديدية
904 - التطور المفاجئ
903 - قتال البق
902 - الزحف نحو الوادي
901 - روح وحش من نوع سهم
900 - النمس المشتعل
899 - ترويض وحش الرياح
898 - شجرة الدم
897 - سان مو
896 - الجينات الروحية
895 - فاكهة النحاس
894 - أكل اللحم
893 - بطل لثلاث ثواني
892 - قوة العملة الذهبية
891 - الشفاء
890 - قوة دلو من الماء
889 - استيعاب النباتات الجينية
888 - سأدعوه بالزعيم
887 - قطرة ماء مدهشة
886 - شجرة تنين الدم القديمة
885 - أعد لي شجرتي
884 - طفرة البلورة السوداء
883 - معبد الأله الثالث
882 - متجاوز
881 - الانتهاء من سوترا نبض الدم
880 - سأجدك
879 - تناول فاكهة الرعد
878 - قتل ثور الرعد
877 - قتال وحوش الرعد
876 - ايجرؤ على ضربي؟
875 - لماذا لا يضربك البرق ؟
874 - جبل الرعد
873 - سكين العظم الدموي
872 - بقايا فيلق الدم
871 - ابن القدر
870 - التابوت الأسود
869 - الصفر تتحرك
868 - الغابة المسكونة
867 - غابة فاكهة غريبة
866 - الملك الجديد للشورى
865 - مهاجمة مأوى شيطان الدم
864 - السكير و الديمي
863 - المتحكم ألفا
862 - SKTS عفا عليها الزمن
861 - فريق الأميرة الملكي
860 - التدريب
859 - بكاء
858 - قوة القرع
857 - البذور الجينية
856 - ميلاد الكنوز الستة
855 - فتح الصناديق
854 - سرقة الصناديق
853 - الصناديق الذهبية ناضجة
852 - تحرك القرع
851 - مشهد غريب علي الجبل الأرجواني
850 - القتل باستمرار
849 - شيطان الدم
848 - اقتحام المأوى
847 - هذا كثير جدا
846 - السيد الثعلب الصغير
845 - جذب المخلوقات الفائقة
844 - الهجوم علي مأوى شيطان الدم
843 - سائل انجيل جين
842 - شجرة اليشم الذهبي
841 - روح الوحش الملك الفارس المدرع
840 - حبوب الحيوانات الأليفة
839 - مكيدة عائلة تشي
838 - الغزال الأبيض
837 - صهري بارد جدا
836 - إله القاعة العسكرية
835 - العمة الصغيرة
834 - معركة الحيوانات الأليفة
833 - كسر السماء المزيفة بيد واحدة
832 - وقت الجنية الصغير للتألق
831 - السمكة العظمية
830 - الاسماك الشفافة الصغيرة
829 - مطاردة ليتل سيلفر للكنز
828 - الكشف عن السر
827 - وماذا ان لم اتوقف؟
826 - الشوري هاه؟ هل هذا كل ما يملكوه؟
825 - اهزمني ويمكنك قتال الدولار
824 - يجب ان يموت
823 - تغيير الشوري
822 - هوانغ شياو
821 - اريد القتال ضد الدولار
820 - يو تشيلاند
819 - مجموعة من الشوري
818 - الملك الفارس
817 - انت تنتمي لي
816 - روح مقدسة
815 - الفاكهة الفارغة الحقيقية
814 - يجب ان تتركه
813 - ابتلاع الفاكهة
812 - نضوج الفاكهة الفارغة
811 - الحيوانات الأليفة الفائقة ليست جيدة
810 - استدعاء حيوان أليف
809 - الفاكهة الفارغة
808 - جذب الكوارث
807 - أوزة مشوية
806 - تجمع المخلوقات الفائقة
805 - صيد صقر الرعد
804 - نحن متساوين , كلاناَ ارواح ملكية
803 - المطالبة بالإمبراطورة
802 - محاربة روح عظمى
801 - الادراك الروحي
800 - روح سوبر
799 - الشبح المدرع
798 - الدخول إلى المأوى
797 - مأوى مخيف
796 - قتل الوحش الصغير
795 - الوحش الذي يسكن بحيرة الزمرد
794 - اليد التي تحكم في القدار
793 - تجاوز وضع السوبر
792 - الملك مع اثنين وسبعين زوجة
791 - السيف التجريبي
790 - دراسة دونغ شوان مرة أخرى
789 - الضربة التي لا تخطئ
788 - من تريد أن تقتل؟
787 - طلب المتاعب
786 - غارة الملابس الداخلية الخارقة
785 - الفراشة ترقص وحدها
784 - مافيا الحشرات
783 - روح عين الشيطان
782 - الامتصاص الثاني
781 - الحصول على روح وحش خارق أخرى
780 - حرب الحشرات
779 - مخلوق زهرة
778 - الغولم الزمردى
777 - الأخ الأعمى
776 - لين بيفنج المكتئب
775 - هل هذا كل ما لديكِ؟
774 - هذا ليس جيدًا
773 - الجينات الروحية
772 - ضد الروح
771 - دمعة النيرفانا المقدسة
770 - أحمر الشفاه
769 - أنت ملكى
768 - باب معدني غامض
767 - وحيد القرن المقدس
766 - صبار الشعر
765 - الصبار المقدس
764 - النظافة المقدسة
763 - واحـــــــة
762 - قبول الجنية
761 - بعوض شهوة الدم
760 - المخلوق الذي يحمل الضوء المقدس
759 - إمرأة عَزْلاءُ
758 - العناية بالجنية
757 - مَحْرُوم
756 - ضربة صوت الرعد
755 - سوترا السماء المزيفة
754 - حقا لم أعلمك؟
753 - قاتل الألهه لوه
752 - ماذا عن الطفل؟
751 - التعرف على أولياء الأمور
750 - إقتــــــــــــــــــــــــــــــراح
749 - آثـــــار
748 - الغشاش من الجيل الثاني
747 - غير مكتمل
746 - قتل العقرب الأرجواني
745 - نبض الدم
744 - ذوبان الجليد
743 - معركة على بحيرة الجليد
742 - اكتشاف صادم
741 - البحيرة المتجمدة
740 - دودة القز الجليدية
739 - غابة الخيزران الغريبة
738 - العقرب القرمزي ثنائي الذنب
737 - ااهرب ام لا ؟؟
736 - مأوي لا أحد
735 - ليتل اورنج
734 - الروح؟
733 - يجب ان تكون هلوسة !!!!
732 - الشيطان لايؤمن بالدموع
731 - محو
730 - شورى بقرن دموي
729 - سائل انجيل جين
728 - حيوان أليف يمتص الدم
727 - هدير الرعد
726 - أخشى أن هذا سيكون صعبًا
725 - جرس الموت
724 - مكافأة كبيرة
723 - جرس النحاس الأزرق
722 - المأوى الأزرق
721 - الجبل الأزرق
720 - بيضة مسروقة
719 - احساس مخيف
718 - ربيع الدم
717 - انجيل جين
716 - مكافأة ابن الاله
715 - قتل ابن الاله الفاتح
714 - كل لكمة ساحقة
713 - الآن المعركة الحقيقية تبدأ
712 - انهض
711 - معركة مع ابن الاله
710 - المجد
709 - اعلان الملك
708 - حب الأب
707 - ايلفنت بانش
706 - عودة الدولار
705 - ابن الاله الفاتح
704 - فوز بضربة واحدة
703 - مسابقة القتال
702 - مهارات الاشتباك
701 - روح الوحش الفائق
700
699
698
697
696
695
694
693
692
691
690
689
688
687
686
685
684
683
682
681
680
679
678
677
676
675
674
673
672
671
670
669
668
667
666
665
664
663
662
661
660
659
658
657
656
655
654
653
652
651
650
649
648
647
646
645
644
643
642
641
"""

def clean_slug(text):
    text = re.sub(r"[؟?()!.'،,]", "", text)
    text = text.strip().replace(" ", "-")
    return re.sub(r'-+', '-', text)

def get_content(url):
    try:
        r = requests.get(url, headers=HEADERS, timeout=12)
        if r.status_code == 200:
            soup = BeautifulSoup(r.content, "html.parser")
            div = soup.find("div", class_="text-left")
            if div: return div.get_text(separator="\n").strip()
    except: pass
    return None

def start():
    lines = [l.strip() for l in raw_chapters_text.strip().split("\n") if l.strip()]
    lines.reverse() # للترتيب من 641 صعوداً إلى 1000
    
    print(f"[*] سحب {len(lines)} فصلاً (من 641 إلى 1000)...")
    
    with open(TXT_OUTPUT, "w", encoding="utf-8") as f:
        for line in lines:
            print(f"[*] جاري العمل على: {line}")
            chapter_num = line.split(" - ")[0].strip()
            
            urls_to_try = [
                f"{BASE_URL}{chapter_num}/", # النمط الرقمي المباشر
                f"{BASE_URL}%d8%a7%d9%84%d9%81%d8%b5%d9%84-{chapter_num}/" # نمط الفصل-رقم
            ]
            
            if " - " in line:
                title = line.split(" - ")[1].strip()
                urls_to_try.insert(0, f"{BASE_URL}{chapter_num}-{clean_slug(title)}/") # نمط العنوان (الأولوية له)

            content = None
            for target_url in urls_to_try:
                content = get_content(target_url)
                if content: break
            
            if content:
                f.write(f"\n\n{'='*20}\nالفصل {line}\n{'='*20}\n\n{content}")
                f.flush()
                print(f"    [V] تم السحب بنجاح")
            else:
                print(f"    [X] فشل السحب لكل المحاولات للفصل {chapter_num}")
            
            time.sleep(random.uniform(0.6, 1.0))

    convert_to_html()

def convert_to_html():
    if not os.path.exists(TXT_OUTPUT): return
    with open(TXT_OUTPUT, "r", encoding="utf-8") as f: content = f.read()
    chapters = content.split("====================")
    html_header = f"<!DOCTYPE html><html dir='rtl' lang='ar'><head><meta charset='UTF-8'><title>Super Gene 641-1000</title><style>body{{font-family:'Segoe UI';padding:20px;line-height:1.8;background:#f4f7f6;max-width:850px;margin:auto;}}.chapter-card{{background:#fff;padding:30px;margin-bottom:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);white-space:pre-wrap;}}h1{{color:#2c3e50;border-bottom:3px solid #27ae60;}}</style></head><body>"
    html_body = ""
    for i in range(1, len(chapters), 2):
        title = chapters[i].strip()
        body = chapters[i+1].strip() if (i+1) < len(chapters) else ""
        if title:
            html_body += f"<div class='chapter-card'><h1>{title}</h1>{body}</div>"
    with open(HTML_OUTPUT, "w", encoding="utf-8") as hf: hf.write(html_header + html_body + "</body></html>")
    print(f"\n[V] اكتملت العملية! الملف النهائي جاهز: {HTML_OUTPUT}")

if __name__ == "__main__":
    start()
